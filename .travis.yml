language: python
matrix:
  include:
  - name: Python 3.7.1 on Xenial Linux
    dist: xenial
    python: '3.7'
  - name: Python 3.7 on macOS
    os: osx
    osx_image: xcode10.2
    language: shell
install:
- pip3 install -r requirements.txt
- pip3 install pyinstaller
script:
- |
  pyinstaller -c --onefile --hidden-import=celery --hidden-import=celery.fixups --hidden-import=celery.fixups.django spinveyor/spinveyor.py
  tar -czvf dist/spinveyor_$TRAVIS_OS_NAME.tar.gz dist/spinveyor

deploy:
  skip_cleanup: true
  draft: true
  overwrite: true
  provider: releases
  api_key:
    secure: qmXFdfdQOup7cdPThUEfz4BDYR2lSRVAfIWC8zwzeJ11wZ+ikck0NzBLzvLZSSopk/sz5gOZ1YdUEDreMPJDxstYp03ZPiR+6UJVZrYxtZlRMJ6lG8l65ogvdT8+kwiGyFPVWV7uksY5sTdEqd6Od5wqTpLCuXIwvUE7lvDeJAhUNA9XXO+BjE3EX4vtqWC94pWO7IeClURbViMb3sbpdxDJiKif0SaUyPtUG384girBqwDS2Xto0Dd4dE4YMg5dGzsWCBd3EdCji7bntpVtDuduu/Ujuao48t5jbRKEoMpzHRvQu/7xNkahS/mec2445Nu2jU2/7fXUPbH8Tb3tfnzbmQ9691wd+ACao8n3kkw5vENOZwszXfkG2R7kUzz/HGQgIkAv0UmhlzwI7z2o7e9o0DljNAnt2h/DToIFEFZYEG02g8nl6EvAbQisTyKyjHjronsAUC9o8UfPRhGnngkh8Yf2bWvx30UN3wG2qGFStSIxK+/pVXix8nwBzQ5zr1PWR1+qxHzAe8ukzMZK+n0tKs5zxWk0q4OCYJY+dJ8tDCdubWIGTXdjkILYJ7VYPS1lANmJVl8L9C0AUnxMjoJoOnmL2Hn5ZIjhQ4sDSW7I5oyXKls+oOr6TeLd+bJ3aqI+pZ5MvilpKp/f+mRZzQ9VxnJQwqFVrMcSCdtXmtQ=
  file_glob:
  file: dist/spinveyor_*.tar.gz
  on:
    repo: spinveyor/spinveyor
